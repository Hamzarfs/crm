import{p as be,c as _e}from"./formatters-DvWGt13L.js";import{p as da}from"./paginationMeta-BbY5dJ0C.js";import{_ as Qe}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-BH4UBKf3.js";import{_ as xe}from"./AppDateTimePicker.vue_vue_type_style_index_0_lang-0cBlYaZ4.js";import{r as L,f as Ye}from"./validators-Z6BjoYpS.js";import{d as De,r as u,o as k,g as U,f as a,b as e,n as t,aG as f,aL as Oe,ai as P,p,aK as pe,w as ne,O as Ge,c as j,e as y,v as b,s as we,F as X,i as de,x as N,Z as Ve,aM as Ue,a0 as $e,a as ua}from"./main-DoQFmMsa.js";import{_ as Ae}from"./AppDrawerHeaderSection.vue_vue_type_script_setup_true_lang-BjbO3N_D.js";import{C as qe}from"./vue3-perfect-scrollbar-Dah25qMm.js";import{V as I}from"./VDivider-CiGpRMeQ.js";import{V as te,b as Y,c as ma}from"./VCard-CvMXks-w.js";import{V as Ee}from"./VForm-MqJCh6j8.js";import{V as ce,a as V}from"./VRow-CBIZXy0V.js";import{V as Pe}from"./VTextField-C5K-JLC3.js";import{V as Be}from"./VTextarea-Ko1LCgfW.js";import{V as ze}from"./VAutocomplete-CtJ28T1f.js";import{V as me}from"./VSelect-DD45070D.js";import{V as Ke}from"./VFileInput-DO7aoXu_.js";import{V as Ne}from"./VNavigationDrawer-C1kAe-dV.js";import{g as je,e as Fe}from"./helpers-BO_WrFPz.js";import{$ as Q}from"./api-B6c1NHMd.js";import{V as ye}from"./VSpacer-DO_vufVD.js";import{V as He}from"./VAvatar-A7ztkq2k.js";import{V as ue}from"./VTooltip-DriPcYkZ.js";import{V as K}from"./VChip-D3GIz1VX.js";import{V as Ze,a as Je}from"./VList-jAkofN4n.js";import{V as We}from"./VMenu-Dwo0kCga.js";import{V as Xe}from"./VDialog-q404EtSX.js";import{u as pa}from"./useApi-CYcmTCPZ.js";import{c as ca}from"./createUrl-Bwjf_k-d.js";import{V as fa}from"./VSwitch-Dj0_1aAO.js";import{V as va}from"./VDataTableServer-Bfaih1x0.js";import{V as ga}from"./VSnackbar-CFNgeUZK.js";import"./VField-BD5A6g5X.js";import"./InputIcon-C91L1USK.js";import"./easing-CjukEv2V.js";import"./VInput-j0tWo3aL.js";import"./VImg-BvvxBpKO.js";import"./forwardRefs-C-GTDzx5.js";/* empty css              *//* empty css                   */import"./VCounter-OXl0Qa9T.js";import"./filter--_JGeJ5X.js";import"./VCheckboxBtn-ybuIpKJx.js";import"./VSelectionControl-CA9osU1B.js";import"./dialog-transition-Cr9rcsZj.js";import"./VOverlay-BtLUM5vY.js";import"./delay-Dhu81iSy.js";import"./lazy-CojwJwNx.js";import"./scopeId-C1Mw3z0g.js";import"./ssrBoot-CpQaGIBj.js";import"./index-9rIf2CJL.js";import"./VSlideGroup-DZ8i23BH.js";import"./VDataTable-Cq00Lau-.js";import"./VPagination-Bz8XJ3Wz.js";import"./VTable-XmEDbQ3e.js";const ka=De({__name:"AddNewTaskDrawer",props:{isDrawerOpen:{type:Boolean},users:{},statuses:{},errors:{}},emits:["update:isDrawerOpen","taskData"],setup(ee,{expose:$,emit:R}){const i=ee,v=R,F=u(!1),E=u(),x=u(""),O=u(""),D=u(),C=u(),_=u("pending"),w=u([]),h=()=>{v("update:isDrawerOpen",!1),pe(()=>{var l,r;(l=E.value)==null||l.reset(),(r=E.value)==null||r.resetValidation()})},S=()=>{var l;(l=E.value)==null||l.validate().then(({valid:r})=>{var A;if(r){const g=new FormData;g.append("title",x.value),g.append("description",O.value),g.append("deadline",D.value),g.append("assigned_to",C.value),g.append("status",_.value),(A=w.value)!=null&&A.length&&w.value.forEach((d,c)=>{g.append(`files[${c}]`,d)}),v("taskData",g)}})};$({closeNavigationDrawer:h});const m=l=>{v("update:isDrawerOpen",l),!l&&pe(()=>{var r;(r=E.value)==null||r.resetValidation()})};return(l,r)=>{const A=Ae,g=xe;return k(),U(Ne,{temporary:"",width:600,location:"end",class:"scrollable-content","model-value":i.isDrawerOpen,"onUpdate:modelValue":m},{default:a(()=>[e(A,{title:"Add New Task",onCancel:h}),e(I),e(t(qe),{options:{wheelPropagation:!1}},{default:a(()=>[e(te,{flat:""},{default:a(()=>[e(Y,null,{default:a(()=>[e(Ee,{ref_key:"refForm",ref:E,modelValue:t(F),"onUpdate:modelValue":r[6]||(r[6]=d=>f(F)?F.value=d:null),onSubmit:Oe(S,["prevent"])},{default:a(()=>[e(ce,null,{default:a(()=>[e(V,{cols:"12"},{default:a(()=>[e(Pe,{modelValue:t(x),"onUpdate:modelValue":r[0]||(r[0]=d=>f(x)?x.value=d:null),rules:["requiredValidator"in l?l.requiredValidator:t(L)],label:"Title","error-messages":i.errors.title,placeholder:"Title"},null,8,["modelValue","rules","error-messages"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(Be,{modelValue:t(O),"onUpdate:modelValue":r[1]||(r[1]=d=>f(O)?O.value=d:null),label:"Description",placeholder:"Description",rules:["requiredValidator"in l?l.requiredValidator:t(L)],"error-messages":i.errors.description,"auto-grow":""},null,8,["modelValue","rules","error-messages"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(g,{modelValue:t(D),"onUpdate:modelValue":r[2]||(r[2]=d=>f(D)?D.value=d:null),label:"Deadline",placeholder:"Deadline",clearable:"",config:{dateFormat:"d-m-Y",minDate:new Date},"clear-icon":"ri-close-line","error-messages":i.errors.deadline,rules:["requiredValidator"in l?l.requiredValidator:t(L)]},null,8,["modelValue","config","error-messages","rules"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(ze,{modelValue:t(C),"onUpdate:modelValue":r[3]||(r[3]=d=>f(C)?C.value=d:null),label:"Assigned To",placeholder:"Assigned To",items:i.users,"auto-select-first":"",clearable:"",chips:"","error-messages":i.errors.assigned_to,rules:["requiredValidator"in l?l.requiredValidator:t(L)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(me,{modelValue:t(_),"onUpdate:modelValue":r[4]||(r[4]=d=>f(_)?_.value=d:null),label:"Select status",placeholder:"Select status","error-messages":i.errors.status,rules:["requiredValidator"in l?l.requiredValidator:t(L)],items:i.statuses},null,8,["modelValue","error-messages","rules","items"])]),_:1}),e(V,{cols:"12"},{default:a(()=>{var d;return[e(Ke,{modelValue:t(w),"onUpdate:modelValue":r[5]||(r[5]=c=>f(w)?w.value=c:null),label:"Select files",placeholder:"Select files",multiple:"","prepend-icon":"","append-icon":"$file",chips:"","show-size":"",clearable:"","error-messages":i.errors.files,rules:["fileValidator"in l?l.fileValidator:t(Ye)],accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt",counter:"","counter-size-string":String((d=t(w))==null?void 0:d.length)},null,8,["modelValue","error-messages","rules","counter-size-string"])]}),_:1}),e(V,{cols:"12"},{default:a(()=>[e(P,{type:"submit",class:"me-4"},{default:a(()=>[p(" Submit ")]),_:1}),e(P,{type:"reset",variant:"outlined",color:"error",onClick:h},{default:a(()=>[p(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),Va=De({__name:"EditTaskDrawer",props:{isDrawerOpen:{type:Boolean},users:{},statuses:{},errors:{},task:{}},emits:["update:isDrawerOpen","taskData"],setup(ee,{expose:$,emit:R}){var m;const i=ee,v=R,F=u(!1),E=u(),x=u(i.task.title),O=u(i.task.description),D=u(be(i.task.deadline)),C=u((m=i.task.assigned_to)==null?void 0:m.id),_=u(i.task.status),w=()=>{v("update:isDrawerOpen",!1),pe(()=>{var l,r;(l=E.value)==null||l.reset(),(r=E.value)==null||r.resetValidation()})};ne(()=>i.task,l=>{var r;x.value=l.title,O.value=l.description,D.value=be(l.deadline),C.value=(r=l.assigned_to)==null?void 0:r.id,_.value=l.status},{immediate:!0,deep:!0});const h=()=>{var l;(l=E.value)==null||l.validate().then(({valid:r})=>{r&&v("taskData",{id:i.task.id,title:x.value,description:O.value,deadline:D.value,assigned_to:C.value,status:_.value})})};$({closeNavigationDrawer:w});const S=l=>{v("update:isDrawerOpen",l)};return(l,r)=>{const A=Ae,g=xe;return k(),U(Ne,{temporary:"",width:600,location:"end",class:"scrollable-content","model-value":i.isDrawerOpen,"onUpdate:modelValue":S},{default:a(()=>[e(A,{title:"Edit Task",onCancel:w}),e(I),e(t(qe),{options:{wheelPropagation:!1}},{default:a(()=>[e(te,{flat:""},{default:a(()=>[e(Y,null,{default:a(()=>[e(Ee,{ref_key:"refForm",ref:E,modelValue:t(F),"onUpdate:modelValue":r[5]||(r[5]=d=>f(F)?F.value=d:null),onSubmit:Oe(h,["prevent"])},{default:a(()=>[e(ce,null,{default:a(()=>[e(V,{cols:"12"},{default:a(()=>[e(Pe,{modelValue:t(x),"onUpdate:modelValue":r[0]||(r[0]=d=>f(x)?x.value=d:null),rules:["requiredValidator"in l?l.requiredValidator:t(L)],label:"Title","error-messages":i.errors.title,placeholder:"Title"},null,8,["modelValue","rules","error-messages"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(Be,{modelValue:t(O),"onUpdate:modelValue":r[1]||(r[1]=d=>f(O)?O.value=d:null),label:"Description",placeholder:"Description",rules:["requiredValidator"in l?l.requiredValidator:t(L)],"error-messages":i.errors.description,"auto-grow":""},null,8,["modelValue","rules","error-messages"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(g,{modelValue:t(D),"onUpdate:modelValue":r[2]||(r[2]=d=>f(D)?D.value=d:null),label:"Deadline",placeholder:"Deadline",clearable:"",config:{dateFormat:"d-m-Y",minDate:new Date(t(D))},"clear-icon":"ri-close-fill","error-messages":i.errors.deadline,rules:["requiredValidator"in l?l.requiredValidator:t(L)]},null,8,["modelValue","config","error-messages","rules"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(ze,{modelValue:t(C),"onUpdate:modelValue":r[3]||(r[3]=d=>f(C)?C.value=d:null),label:"Assigned To",placeholder:"Assigned To",items:i.users,"auto-select-first":"",clearable:"",chips:"","error-messages":i.errors.assigned_to,rules:["requiredValidator"in l?l.requiredValidator:t(L)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(me,{modelValue:t(_),"onUpdate:modelValue":r[4]||(r[4]=d=>f(_)?_.value=d:null),label:"Select status",placeholder:"Select status","error-messages":i.errors.status,rules:["requiredValidator"in l?l.requiredValidator:t(L)],items:i.statuses},null,8,["modelValue","error-messages","rules","items"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(P,{type:"submit",class:"me-4"},{default:a(()=>[p(" Submit ")]),_:1}),e(P,{type:"reset",variant:"outlined",color:"error",onClick:w},{default:a(()=>[p(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),ya={class:"d-flex align-center"},ba=y("h3",{class:"text-h6"},"Assigned to",-1),_a={class:"d-flex align-center"},wa={class:"text-body-1 font-weight-medium"},Da={class:"d-flex align-center"},ha=y("h3",{class:"text-h6"},"Status",-1),Ca=y("span",null,"Click to update status",-1),Ta={class:"d-flex align-center"},Sa=y("h3",{class:"text-h6"},"Deadline",-1),Ua=y("h3",{class:"text-h6"},"Files",-1),$a={class:"d-flex flex-wrap"},Fa=y("h3",{class:"text-h6 mb-3"},"Description",-1),xa=y("h3",{class:"text-h6 mb-3"},"Comments",-1),Oa={class:"d-flex justify-space-between align-center mb-3"},Aa={class:"d-flex gap-3 align-center"},qa={class:"text-body-1 font-weight-medium"},Ea={class:"text-caption"},Pa={class:"text-body-1"},Ba={key:0},za=De({__name:"ViewTaskDrawer",props:{isDrawerOpen:{type:Boolean},task:{},statuses:{},errors:{},resolveTaskStatusColor:{type:Function}},emits:["update:isDrawerOpen","commentData","statusUpdate","deleteComment"],setup(ee,{expose:$,emit:R}){const i=Ge("userData").value,v=ee,F=R,E=m=>{F("update:isDrawerOpen",m),!m&&pe(()=>{var l,r;(l=C.value)==null||l.reset(),(r=C.value)==null||r.resetValidation()})},x=()=>{F("update:isDrawerOpen",!1),pe(()=>{var m,l;(m=C.value)==null||m.reset(),(l=C.value)==null||l.resetValidation()})},O=async(m,l)=>{var d;const r=await Q(`/tasks/files/${m.id}`,{responseType:"blob"}),A=URL.createObjectURL(new Blob([r])),g=document.createElement("a");g.href=A,g.setAttribute("download",`File ${l+1}.${Fe(m.file)}`),document.body.appendChild(g),g.click(),(d=g.parentNode)==null||d.removeChild(g)},D=u([]),C=u(),_=u(!1),w=u(!1);let h;const S=m=>{var l;(l=C.value)==null||l.validate().then(async({valid:r})=>{if(r){const A=new FormData(m.target);F("commentData",A)}})};return $({commentForm:C}),(m,l)=>{const r=Ae,A=Qe;return k(),j(X,null,[e(Ne,{temporary:"",width:600,location:"end",class:"scrollable-content","model-value":v.isDrawerOpen,"onUpdate:modelValue":E},{default:a(()=>[e(r,{title:v.task.title,onCancel:x},null,8,["title"]),e(I),e(t(qe),{options:{wheelPropagation:!1}},{default:a(()=>[e(te,{flat:""},{default:a(()=>[e(Y,null,{default:a(()=>[e(ce,null,{default:a(()=>{var g;return[e(V,{cols:"12"},{default:a(()=>{var d;return[y("div",ya,[ba,e(ye),y("div",_a,[e(He,{size:"small",color:"primary",variant:"tonal",class:"me-2"},{default:a(()=>{var c;return[p(b(("getInitials"in m?m.getInitials:t(je))((c=v.task.assigned_to)==null?void 0:c.name)),1)]}),_:1}),y("span",wa,b((d=v.task.assigned_to)==null?void 0:d.name),1)])])]}),_:1}),e(I),e(V,{cols:"12"},{default:a(()=>{var d;return[y("div",Da,[ha,e(ye),t(i).id===((d=v.task.assigned_to)==null?void 0:d.id)?(k(),U(We,{key:0,transition:"slide-y-transition"},{activator:a(({props:c})=>[e(ue,{location:"top"},{activator:a(({props:z})=>[e(K,we(we(c,z),{elevation:"5",color:m.resolveTaskStatusColor(v.task.status),size:"small",class:"text-uppercase"}),{default:a(()=>{var Z;return[p(b((Z=m.statuses.find(G=>G.value===v.task.status))==null?void 0:Z.title),1)]}),_:2},1040,["color"])]),default:a(()=>[Ca]),_:2},1024)]),default:a(()=>[e(Ze,null,{default:a(()=>[(k(!0),j(X,null,de(m.statuses,c=>(k(),U(Je,{key:c.value,value:c.value,onClick:z=>F("statusUpdate",{id:v.task.id,status:c.value})},{default:a(()=>[p(b(c.title),1)]),_:2},1032,["value","onClick"]))),128))]),_:1})]),_:1})):(k(),U(K,{key:1,color:m.resolveTaskStatusColor(v.task.status),size:"small",class:"text-uppercase",elevation:"5"},{default:a(()=>{var c;return[p(b((c=m.statuses.find(z=>z.value===v.task.status))==null?void 0:c.title),1)]}),_:1},8,["color"]))])]}),_:1}),e(I),e(V,{cols:"12"},{default:a(()=>[y("div",Ta,[Sa,e(ye),e(K,{color:("checkDeadlineStatus"in m?m.checkDeadlineStatus:t(_e))(v.task.deadline)==="exceeded"?"error":("checkDeadlineStatus"in m?m.checkDeadlineStatus:t(_e))(v.task.deadline)==="approaching"?"success":"warning",elevation:"5",size:"small",class:"font-weight-medium"},{default:a(()=>[p(b(("parseDate"in m?m.parseDate:t(be))(v.task.deadline)),1)]),_:1},8,["color"])])]),_:1}),e(I),((g=v.task.files)==null?void 0:g.length)>0?(k(),j(X,{key:0},[e(V,{cols:"12"},{default:a(()=>[Ua,y("div",$a,[(k(!0),j(X,null,de(v.task.files,(d,c)=>(k(),U(K,{class:"me-2 mb-2",key:d.id,style:{width:"fit-content"},elevation:"5",variant:"elevated","prepend-icon":"$file",color:"primary",onClick:z=>O(d,c)},{default:a(()=>[p(b(`File ${c+1}.${("extractFileExtension"in m?m.extractFileExtension:t(Fe))(d.file)}`),1)]),_:2},1032,["onClick"]))),128))])]),_:1}),e(I)],64)):N("",!0),e(V,{cols:"12"},{default:a(()=>[Fa,y("p",null,b(v.task.description),1)]),_:1}),e(I),e(V,{cols:"12"},{default:a(()=>{var d;return[xa,((d=v.task.comments)==null?void 0:d.length)>0?(k(!0),j(X,{key:0},de(v.task.comments,(c,z)=>{var Z;return k(),j("div",{key:c.id,class:"mb-5"},[y("div",Oa,[y("div",null,[y("div",Aa,[e(He,{color:"primary",variant:"tonal"},{default:a(()=>[p(b(("getInitials"in m?m.getInitials:t(je))(c.created_by.name)),1)]),_:2},1024),y("div",null,[y("div",qa,b(c.created_by.name),1),y("div",Ea,b(c.created_at),1)])])]),y("div",null,[t(i).role.value==="admin"||c.created_by.id===t(i).id?(k(),U(P,{key:0,size:"small",variant:"tonal",color:"error",icon:"ri-delete-bin-6-line",onClick:G=>{w.value=!0,f(h)?h.value=z:h=z}},null,8,["onClick"])):N("",!0)])]),y("p",Pa,b(c.comment),1),((Z=c.files)==null?void 0:Z.length)>0?(k(),j("div",Ba,[(k(!0),j(X,null,de(c.files,(G,fe)=>(k(),U(K,{class:"me-2 mb-2",key:G.id,style:{width:"fit-content"},elevation:"5",variant:"elevated","prepend-icon":"$file",color:"primary",onClick:Re=>O(G,fe)},{default:a(()=>[p(b(`File ${fe+1}.${("extractFileExtension"in m?m.extractFileExtension:t(Fe))(G.file)}`),1)]),_:2},1032,["onClick"]))),128))])):N("",!0),z!==v.task.comments.length-1?(k(),U(I,{key:1,class:"my-3"})):N("",!0)])}),128)):N("",!0),e(Ee,{ref_key:"refForm",ref:C,modelValue:t(_),"onUpdate:modelValue":l[1]||(l[1]=c=>f(_)?_.value=c:null),onSubmit:Oe(S,["prevent"])},{default:a(()=>[e(ce,null,{default:a(()=>[e(V,{cols:"12"},{default:a(()=>[e(Be,{label:"Comment",placeholder:"Comment",name:"comment",rules:["requiredValidator"in m?m.requiredValidator:t(L)],"auto-grow":"",rows:"2"},null,8,["rules"])]),_:1}),e(V,{cols:"12"},{default:a(()=>{var c;return[e(Ke,{modelValue:t(D),"onUpdate:modelValue":l[0]||(l[0]=z=>f(D)?D.value=z:null),label:"Select files",placeholder:"Select files",clearable:"",multiple:"","prepend-icon":"","append-icon":"$file",chips:"","show-size":"",rules:["fileValidator"in m?m.fileValidator:t(Ye)],counter:"",color:"primary","counter-size-string":String((c=t(D))==null?void 0:c.length),name:"files[]",accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt"},null,8,["modelValue","rules","counter-size-string"])]}),_:1}),e(V,{cols:"12"},{default:a(()=>[e(P,{type:"submit",class:"me-4"},{default:a(()=>[p(" Submit ")]),_:1}),e(P,{type:"reset",variant:"outlined",color:"error",onClick:x},{default:a(()=>[p(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1})]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(Xe,{modelValue:t(w),"onUpdate:modelValue":l[5]||(l[5]=g=>f(w)?w.value=g:null),width:"400"},{default:a(()=>[e(te,{title:"Confirmation",class:"pb-5"},{default:a(()=>[e(A,{variant:"text",size:"default",onClick:l[2]||(l[2]=g=>w.value=!1)}),e(Y,null,{default:a(()=>[p(" Are you sure you want to delete this comment ? ")]),_:1}),e(Y,{class:"d-flex align-center justify-center gap-4"},{default:a(()=>[e(P,{variant:"elevated",onClick:l[3]||(l[3]=g=>{w.value=!1,F("deleteComment",t(h))}),color:"error"},{default:a(()=>[p(" Confirm ")]),_:1}),e(P,{color:"secondary",variant:"outlined",onClick:l[4]||(l[4]=g=>w.value=!1)},{default:a(()=>[p(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Na=y("span",null,"Click to update status",-1),Ra={class:"d-flex justify-end flex-wrap gap-x-6 px-2 py-1"},Ma={class:"d-flex align-center gap-x-2 text-medium-emphasis text-base"},Ia={class:"d-flex align-center text-base text-high-emphasis me-2 mb-0"},La={class:"d-flex gap-x-2 align-center me-2"},Ht=De({__name:"list",async setup(ee){let $,R;const i=Ge("userData").value,v=u(""),F=u(),E=u(),x=u(),O=u(),D=u(!1),C=u("no");ne(D,n=>{C.value=n?"yes":"no"});const _=u({});let w;const h=u(20),S=u(1),m=u("id"),l=u("desc"),r=u([]),A=u(!1),g=u(),d=u(),c=u(),z=n=>{var s,T;m.value=(s=n.sortBy[0])==null?void 0:s.key,l.value=(T=n.sortBy[0])==null?void 0:T.order},Z=[{title:"ID",key:"id"},{title:"Title",key:"title"},{title:"Status",key:"status"},{title:"Department",key:"department",sortable:!1,showToOnly:["admin"]},{title:"Assigned To",key:"assigned_to",sortable:!1,showToOnly:["admin","team_lead"]},{title:"Deadline",key:"deadline"},{title:"Created By",key:"created_by",sortable:!1,showToOnly:["admin"]},{title:"Creation Date",key:"created_at"},{title:"Last Updated",key:"updated_at"},{title:"Actions",key:"actions",sortable:!1}],G=Ve(()=>Z.filter(n=>n.showToOnly?n.showToOnly.includes(i.role.value):n)),fe=Ve(()=>{const n={q:v,user:F,department:E,date:x,status:O,itemsPerPage:h,page:S,sortBy:m,orderBy:l};return i.role.value==="team_lead"&&(n.assignedToMe=C),n}),Re=Ve(()=>{var s,T,q;const n={};return(s=i==null?void 0:i.department)!=null&&s.id&&((T=i==null?void 0:i.department)==null?void 0:T.id)!==1&&(n.department=(q=i==null?void 0:i.department)==null?void 0:q.id),n}),{data:he,execute:Ce,isFetching:ea}=([$,R]=Ue(()=>pa(ca("tasks",{query:fe}))),$=await $,R(),$);ne(()=>ea.value,n=>{A.value=n},{immediate:!0});const Te=u(he.value.tasks),le=Ve(()=>he.value.totalTasks);ne(he,n=>{Te.value=n.tasks});const J=[{title:"Pending",value:"pending"},{title:"In Progress",value:"in_progress"},{title:"Completed",value:"completed"}],ve=u([]),Me=u([]);if(["admin","team_lead"].includes(i.role.value)){const{users:n}=([$,R]=Ue(()=>Q("users",{query:Re.value})),$=await $,R(),$);if(ve.value=n.map(s=>({value:s.id,title:s.name})),i.role.value==="admin"){const{departments:s}=([$,R]=Ue(()=>Q("departments")),$=await $,R(),$);Me.value=s.map(T=>({title:T.title,value:T.id}))}}const Se=n=>{switch(n){case"completed":return"success";case"in_progress":return"info";default:return"error"}},ge=u(!1),se=u(!1),oe=u(!1),M=u(!1),W=u(!1);let H;const aa=async n=>{const{success:s,message:T}=await Q("tasks",{method:"POST",body:n,onResponseError({response:q}){re.value=q._data.errors}});s&&(M.value=!0,H=T,g.value.closeNavigationDrawer(),Ce())},ta=async n=>{const{success:s,message:T}=await Q(`tasks/${n.id}`,{method:"PUT",body:n,onResponseError({response:q}){re.value=q._data.errors}});s&&(M.value=!0,H=T,d.value.closeNavigationDrawer(),Ce())},la=n=>{_.value=n,oe.value=!0},sa=async()=>{const{success:n,message:s}=await Q(`tasks/${w}`,{method:"DELETE"});W.value=!1,n&&(M.value=!0,H=s,Ce())},oa=async n=>{const{success:s,message:T,comment:q}=await Q(`tasks/${_.value.id}/comments`,{method:"POST",body:n});s&&(M.value=!0,H=T,_.value.comments.push(q),c.value.commentForm.reset())},ra=n=>{_.value=n,se.value=!0},re=u({title:void 0,description:void 0,deadline:void 0,assigned_to:void 0,files:[],status:void 0,comment:void 0}),Ie=async({id:n,status:s})=>{const T=Te.value.find(q=>q.id===n);if(T.status!==s){const{success:q,message:ie}=await Q(`tasks/${n}/status`,{method:"PATCH",body:{status:s},onResponseError({response:o}){console.error(o._data.message),M.value=!0,H="Something went wrong! Please try again."}});q&&(T.status=s,M.value=!0,H=ie)}},ae=n=>A.value||!(i.role.value==="admin"||n===i.id),ia=async n=>{const s=_.value.comments[n],{success:T,message:q}=await Q(`tasks/comments/${s.id}`,{method:"DELETE",onResponseError({response:ie}){console.error(ie._data.message),M.value=!0,H="Something went wrong! Please try again."}});T&&(_.value.comments.splice(n,1),M.value=!0,H=q)};return ne([se,oe],([n,s])=>{!n&&!s&&(_.value={})}),(n,s)=>{const T=xe,q=ua("IconBtn"),ie=Qe;return k(),j("section",null,[e(te,{class:"mb-6"},{default:a(()=>[e(ma,{class:"text-h4 py-5"},{default:a(()=>[p(b(["admin","team_lead"].includes(t(i).role.value)?"Filters":"Tasks"),1)]),_:1}),["admin","team_lead"].includes(t(i).role.value)?(k(),U(Y,{key:0},{default:a(()=>[e(ce,{align:"center"},{default:a(()=>[t(i).role.value==="team_lead"?(k(),U(V,{key:0,cols:"2"},{default:a(()=>[e(fa,{modelValue:t(D),"onUpdate:modelValue":s[0]||(s[0]=o=>f(D)?D.value=o:null),inset:!1,label:t(D)?"Assigned to me":"Assigned by me"},null,8,["modelValue","label"])]),_:1})):N("",!0),t(i).role.value==="admin"?(k(),U(V,{key:1},{default:a(()=>[e(me,{modelValue:t(E),"onUpdate:modelValue":s[1]||(s[1]=o=>f(E)?E.value=o:null),label:"Filter by Department",placeholder:"Filter by Department",items:t(Me),clearable:"",chips:""},null,8,["modelValue","items"])]),_:1})):N("",!0),["admin","team_lead"].includes(t(i).role.value)?(k(),U(V,{key:2},{default:a(()=>[e(ze,{modelValue:t(F),"onUpdate:modelValue":s[2]||(s[2]=o=>f(F)?F.value=o:null),label:"Filter by User",placeholder:"Filter by User",items:t(ve),"auto-select-first":"",clearable:"",chips:""},null,8,["modelValue","items"])]),_:1})):N("",!0),e(V,null,{default:a(()=>[e(T,{modelValue:t(x),"onUpdate:modelValue":s[3]||(s[3]=o=>f(x)?x.value=o:null),label:"Filter by Date",placeholder:"Filter by Date",clearable:"",config:{dateFormat:"d-m-Y"},"clear-icon":"ri-close-line"},null,8,["modelValue"])]),_:1}),["admin","team_lead"].includes(t(i).role.value)?(k(),U(V,{key:3},{default:a(()=>[e(me,{modelValue:t(O),"onUpdate:modelValue":s[4]||(s[4]=o=>f(O)?O.value=o:null),label:"Filter by Status",placeholder:"Filter by Status",items:J,clearable:"",chips:""},null,8,["modelValue"])]),_:1})):N("",!0),e(V,null,{default:a(()=>[e(Pe,{modelValue:t(v),"onUpdate:modelValue":s[5]||(s[5]=o=>f(v)?v.value=o:null),placeholder:"Filter by Query",density:"comfortable",clearable:"",label:"Filter by Query",class:"me-4"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):N("",!0),e(I),["admin","team_lead"].includes(t(i).role.value)?(k(),U(Y,{key:1,class:"d-flex flex-wrap gap-4"},{default:a(()=>[e(P,{color:"success","prepend-icon":"ri-upload-2-line"},{default:a(()=>[p(" Import ")]),_:1}),e(P,{color:"secondary","prepend-icon":"ri-download-2-line"},{default:a(()=>[p(" Export ")]),_:1}),e(ye),e(P,{onClick:s[6]||(s[6]=o=>ge.value=!0),"prepend-icon":"ri-task-fill"},{default:a(()=>[p(" Add New Task ")]),_:1})]),_:1})):N("",!0),e(va,{"items-per-page":t(h),"onUpdate:itemsPerPage":s[10]||(s[10]=o=>f(h)?h.value=o:null),"model-value":t(r),"onUpdate:modelValue":s[11]||(s[11]=o=>f(r)?r.value=o:null),hover:"","show-select":"","sort-by":[{key:t(m),order:t(l)}],loading:t(A),"loading-text":"Loading Tasks...","disable-sort":t(A),"fixed-header":"",style:{"max-height":"500px"},page:t(S),"onUpdate:page":s[12]||(s[12]=o=>f(S)?S.value=o:null),items:t(Te),"item-value":"id","items-length":t(le),headers:t(G),class:"text-no-wrap rounded-0","onUpdate:options":z,density:"default"},{"item.status":a(({item:o})=>[t(i).id===o.assigned_to.id?(k(),U(We,{key:0,transition:"slide-y-transition"},{activator:a(({props:B})=>[e(ue,{location:"top"},{activator:a(({props:ke})=>[e(K,we(we(B,ke),{elevation:"5",color:Se(o.status),size:"small",class:"text-uppercase"}),{default:a(()=>{var Le;return[p(b((Le=J.find(na=>na.value===o.status))==null?void 0:Le.title),1)]}),_:2},1040,["color"])]),default:a(()=>[Na]),_:2},1024)]),default:a(()=>[e(Ze,null,{default:a(()=>[(k(),j(X,null,de(J,B=>e(Je,{key:B.value,value:B.value,onClick:ke=>Ie({id:o.id,status:B.value})},{default:a(()=>[p(b(B.title),1)]),_:2},1032,["value","onClick"])),64))]),_:2},1024)]),_:2},1024)):(k(),U(K,{key:1,color:Se(o.status),size:"small",class:"text-uppercase",elevation:"5"},{default:a(()=>{var B;return[p(b((B=J.find(ke=>ke.value===o.status))==null?void 0:B.title),1)]}),_:2},1032,["color"]))]),"item.department":a(({item:o})=>{var B;return[p(b(((B=o.assigned_to.department)==null?void 0:B.title)??"Not assigned"),1)]}),"item.assigned_to":a(({item:o})=>[p(b(o.assigned_to.name),1)]),"item.deadline":a(({item:o})=>[e(K,{color:("checkDeadlineStatus"in n?n.checkDeadlineStatus:t(_e))(o.deadline)==="exceeded"?"error":("checkDeadlineStatus"in n?n.checkDeadlineStatus:t(_e))(o.deadline)==="approaching"?"success":"warning",size:"small",elevation:"5"},{default:a(()=>[p(b(("parseDate"in n?n.parseDate:t(be))(o.deadline)),1)]),_:2},1032,["color"])]),"item.created_by":a(({item:o})=>[p(b(o.created_by.name),1)]),"item.created_at":a(({item:o})=>[p(b(o.created_at),1)]),"item.updated_at":a(({item:o})=>[p(b(o.updated_at),1)]),"item.actions":a(({item:o})=>[e(q,{size:"small",disabled:t(A),color:"info",onClick:B=>la(o),variant:"flat"},{default:a(()=>[e($e,{icon:"ri-eye-fill"}),e(ue,{activator:"parent",location:"top"},{default:a(()=>[p(" View ")]),_:1})]),_:2},1032,["disabled","onClick"]),e(q,{size:"small",onClick:B=>ra(o),color:"primary",variant:ae(o.created_by.id)?"text":"flat",class:"mx-2",disabled:ae(o.created_by.id)},{default:a(()=>[e($e,{icon:ae(o.created_by.id)?"ri-edit-box-line":"ri-edit-box-fill"},null,8,["icon"]),e(ue,{activator:"parent",location:"top"},{default:a(()=>[p(" Edit ")]),_:1})]),_:2},1032,["onClick","variant","disabled"]),e(q,{onClick:B=>{W.value=!0,f(w)?w.value=o.id:w=o.id},color:"error",size:"small",variant:ae(o.created_by.id)?"text":"flat",disabled:ae(o.created_by.id)},{default:a(()=>[e($e,{icon:ae(o.created_by.id)?"ri-delete-bin-line":"ri-delete-bin-fill"},null,8,["icon"]),e(ue,{activator:"parent",location:"top"},{default:a(()=>[p(" Delete ")]),_:1})]),_:2},1032,["onClick","variant","disabled"])]),bottom:a(()=>[e(I),y("div",Ra,[y("div",Ma,[p(" Rows Per Page: "),e(me,{modelValue:t(h),"onUpdate:modelValue":s[7]||(s[7]=o=>f(h)?h.value=o:null),class:"per-page-select",variant:"plain",items:[10,20,25,50,100]},null,8,["modelValue"])]),y("p",Ia,b(("paginationMeta"in n?n.paginationMeta:t(da))({page:t(S),itemsPerPage:t(h)},t(le))),1),y("div",La,[e(P,{class:"flip-in-rtl",icon:"ri-arrow-left-s-line",variant:"text",density:"comfortable",color:"high-emphasis",disabled:t(S)<=1,onClick:s[8]||(s[8]=o=>t(S)<=1?S.value=1:S.value--)},null,8,["disabled"]),e(P,{class:"flip-in-rtl",icon:"ri-arrow-right-s-line",density:"comfortable",variant:"text",color:"high-emphasis",disabled:t(S)>=Math.ceil(t(le)/t(h)),onClick:s[9]||(s[9]=o=>t(S)>=Math.ceil(t(le)/t(h))?S.value=Math.ceil(t(le)/t(h)):S.value++)},null,8,["disabled"])])])]),_:1},8,["items-per-page","model-value","sort-by","loading","disable-sort","page","items","items-length","headers"])]),_:1}),["admin","team_lead"].includes(t(i).role.value)?(k(),U(ka,{key:0,isDrawerOpen:t(ge),"onUpdate:isDrawerOpen":s[13]||(s[13]=o=>f(ge)?ge.value=o:null),onTaskData:aa,users:t(ve),statuses:J,ref_key:"addNewTaskDrawerRef",ref:g,errors:t(re)},null,8,["isDrawerOpen","users","errors"])):N("",!0),["admin","team_lead"].includes(t(i).role.value)?(k(),U(Va,{key:1,isDrawerOpen:t(se),"onUpdate:isDrawerOpen":s[14]||(s[14]=o=>f(se)?se.value=o:null),onTaskData:ta,users:t(ve),statuses:J,task:t(_),ref_key:"editTaskDrawerRef",ref:d,errors:t(re)},null,8,["isDrawerOpen","users","task","errors"])):N("",!0),e(za,{isDrawerOpen:t(oe),"onUpdate:isDrawerOpen":s[15]||(s[15]=o=>f(oe)?oe.value=o:null),task:t(_),statuses:J,resolveTaskStatusColor:Se,errors:t(re),ref_key:"viewTaskDrawerRef",ref:c,onCommentData:oa,onStatusUpdate:Ie,onDeleteComment:ia},null,8,["isDrawerOpen","task","errors"]),e(ga,{modelValue:t(M),"onUpdate:modelValue":s[17]||(s[17]=o=>f(M)?M.value=o:null)},{actions:a(()=>[e(P,{color:"error",onClick:s[16]||(s[16]=o=>M.value=!1)},{default:a(()=>[p(" Close ")]),_:1})]),default:a(()=>[p(b(t(H))+" ",1)]),_:1},8,["modelValue"]),e(Xe,{modelValue:t(W),"onUpdate:modelValue":s[21]||(s[21]=o=>f(W)?W.value=o:null),width:"400"},{default:a(()=>[e(te,{title:"Confirmation",class:"pb-5"},{default:a(()=>[e(ie,{variant:"text",size:"default",onClick:s[18]||(s[18]=o=>W.value=!1)}),e(Y,null,{default:a(()=>[p(" Are you sure you want to delete this task? ")]),_:1}),e(Y,{class:"d-flex align-center justify-center gap-4"},{default:a(()=>[e(P,{variant:"elevated",onClick:s[19]||(s[19]=o=>sa()),color:"error"},{default:a(()=>[p(" Confirm ")]),_:1}),e(P,{color:"secondary",variant:"outlined",onClick:s[20]||(s[20]=o=>W.value=!1)},{default:a(()=>[p(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{Ht as default};
