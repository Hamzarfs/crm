import{p as be,c as _e}from"./formatters-DvWGt13L.js";import{p as na}from"./paginationMeta-BbY5dJ0C.js";import{_ as He}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-DcuUperp.js";import{_ as xe}from"./AppDateTimePicker.vue_vue_type_style_index_0_lang-DQLFN7AC.js";import{r as L,f as Qe}from"./validators-Z6BjoYpS.js";import{d as De,r as u,o as k,g as S,f as a,b as e,n as t,aG as f,aL as Oe,ai as E,p,aK as pe,w as ne,O as Ye,c as j,e as y,v as b,s as we,F as X,i as de,x as N,Z as Se,aM as Ue,a0 as $e,a as da}from"./main-FCzYu4Z5.js";import{_ as Ae}from"./AppDrawerHeaderSection.vue_vue_type_script_setup_true_lang-BVcUhHbr.js";import{C as qe}from"./vue3-perfect-scrollbar-gC16KFl8.js";import{V as I}from"./VDivider-knA9H03k.js";import{V as te,b as Y,c as ua}from"./VCard-Do568HRS.js";import{V as Ee}from"./VForm-DAROEqCA.js";import{V as ce,a as V}from"./VRow-DcbkzY-u.js";import{V as Pe}from"./VTextField-JeOZvJkP.js";import{V as Be}from"./VTextarea-C8uTW21O.js";import{V as ze}from"./VAutocomplete-DeqSS5r6.js";import{V as me}from"./VSelect-B3zOJvEu.js";import{V as Ge}from"./VFileInput-CIoW3ZeP.js";import{V as Ne}from"./VNavigationDrawer-Ae1xKXtE.js";import{g as Le,e as Fe}from"./helpers-BO_WrFPz.js";import{$ as Q}from"./api-CRIIns0m.js";import{V as ye}from"./VSpacer-DgLf_p26.js";import{V as je}from"./VAvatar-CP8SEjMm.js";import{V as ue}from"./VTooltip-SL5-U2jd.js";import{V as K}from"./VChip-ChL126MO.js";import{V as Ke,a as Ze}from"./VList-DBeUyEP9.js";import{V as Je}from"./VMenu-B6LO-Wa5.js";import{V as We}from"./VDialog-BbF2kOnV.js";import{u as ma}from"./useApi-D4hKsd0_.js";import{c as pa}from"./createUrl-nUDDzJFe.js";import{V as ca}from"./VSwitch-DY5wHWk4.js";import{V as fa}from"./VDataTableServer-Bip6aotq.js";import{V as va}from"./VSnackbar-xVpasArO.js";import"./VField-Dk2Ak1ql.js";import"./InputIcon-wsmb1BjU.js";import"./easing-CjukEv2V.js";import"./VInput-B2EWUdv0.js";import"./VImg-CJF-w0vk.js";import"./forwardRefs-C-GTDzx5.js";/* empty css              *//* empty css                   */import"./VCounter-fwUCpOxO.js";import"./filter-D7wIZvCz.js";import"./VCheckboxBtn-B0Ml4Fv6.js";import"./VSelectionControl-CjMQjtTf.js";import"./dialog-transition-CkzesdKy.js";import"./VOverlay-CJoYV0aa.js";import"./delay-ghhtiNk_.js";import"./lazy-s9MkjEdz.js";import"./scopeId-C8kA2Rpd.js";import"./ssrBoot-CaII-3XN.js";import"./index-9rIf2CJL.js";import"./VSlideGroup-CrEC992E.js";import"./VDataTable-BGPZE7tW.js";import"./VPagination-ABgY-7nO.js";import"./VTable-DTLm3gSp.js";const ga=De({__name:"AddNewTaskDrawer",props:{isDrawerOpen:{type:Boolean},users:{},statuses:{},errors:{}},emits:["update:isDrawerOpen","taskData"],setup(ee,{expose:U,emit:R}){const n=ee,v=R,$=u(!1),q=u(),F=u(""),x=u(""),D=u(),C=u(),_=u("pending"),w=u([]),h=()=>{v("update:isDrawerOpen",!1),pe(()=>{var l,r;(l=q.value)==null||l.reset(),(r=q.value)==null||r.resetValidation()})},T=()=>{var l;(l=q.value)==null||l.validate().then(({valid:r})=>{var O;if(r){const g=new FormData;g.append("title",F.value),g.append("description",x.value),g.append("deadline",D.value),g.append("assigned_to",C.value),g.append("status",_.value),(O=w.value)!=null&&O.length&&w.value.forEach((d,c)=>{g.append(`files[${c}]`,d)}),v("taskData",g)}})};U({closeNavigationDrawer:h});const m=l=>{v("update:isDrawerOpen",l),!l&&pe(()=>{var r;(r=q.value)==null||r.resetValidation()})};return(l,r)=>{const O=Ae,g=xe;return k(),S(Ne,{temporary:"",width:600,location:"end",class:"scrollable-content","model-value":n.isDrawerOpen,"onUpdate:modelValue":m},{default:a(()=>[e(O,{title:"Add New Task",onCancel:h}),e(I),e(t(qe),{options:{wheelPropagation:!1}},{default:a(()=>[e(te,{flat:""},{default:a(()=>[e(Y,null,{default:a(()=>[e(Ee,{ref_key:"refForm",ref:q,modelValue:t($),"onUpdate:modelValue":r[6]||(r[6]=d=>f($)?$.value=d:null),onSubmit:Oe(T,["prevent"])},{default:a(()=>[e(ce,null,{default:a(()=>[e(V,{cols:"12"},{default:a(()=>[e(Pe,{modelValue:t(F),"onUpdate:modelValue":r[0]||(r[0]=d=>f(F)?F.value=d:null),rules:["requiredValidator"in l?l.requiredValidator:t(L)],label:"Title","error-messages":n.errors.title,placeholder:"Title"},null,8,["modelValue","rules","error-messages"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(Be,{modelValue:t(x),"onUpdate:modelValue":r[1]||(r[1]=d=>f(x)?x.value=d:null),label:"Description",placeholder:"Description",rules:["requiredValidator"in l?l.requiredValidator:t(L)],"error-messages":n.errors.description,"auto-grow":""},null,8,["modelValue","rules","error-messages"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(g,{modelValue:t(D),"onUpdate:modelValue":r[2]||(r[2]=d=>f(D)?D.value=d:null),label:"Deadline",placeholder:"Deadline",clearable:"",config:{dateFormat:"d-m-Y",minDate:new Date},"clear-icon":"ri-close-line","error-messages":n.errors.deadline,rules:["requiredValidator"in l?l.requiredValidator:t(L)]},null,8,["modelValue","config","error-messages","rules"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(ze,{modelValue:t(C),"onUpdate:modelValue":r[3]||(r[3]=d=>f(C)?C.value=d:null),label:"Assigned To",placeholder:"Assigned To",items:n.users,"auto-select-first":"",clearable:"",chips:"","error-messages":n.errors.assigned_to,rules:["requiredValidator"in l?l.requiredValidator:t(L)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(me,{modelValue:t(_),"onUpdate:modelValue":r[4]||(r[4]=d=>f(_)?_.value=d:null),label:"Select status",placeholder:"Select status","error-messages":n.errors.status,rules:["requiredValidator"in l?l.requiredValidator:t(L)],items:n.statuses},null,8,["modelValue","error-messages","rules","items"])]),_:1}),e(V,{cols:"12"},{default:a(()=>{var d;return[e(Ge,{modelValue:t(w),"onUpdate:modelValue":r[5]||(r[5]=c=>f(w)?w.value=c:null),label:"Select files",placeholder:"Select files",multiple:"","prepend-icon":"","append-icon":"$file",chips:"","show-size":"",clearable:"","error-messages":n.errors.files,rules:["fileValidator"in l?l.fileValidator:t(Qe)],accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt",counter:"","counter-size-string":String((d=t(w))==null?void 0:d.length)},null,8,["modelValue","error-messages","rules","counter-size-string"])]}),_:1}),e(V,{cols:"12"},{default:a(()=>[e(E,{type:"submit",class:"me-4"},{default:a(()=>[p(" Submit ")]),_:1}),e(E,{type:"reset",variant:"outlined",color:"error",onClick:h},{default:a(()=>[p(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),ka=De({__name:"EditTaskDrawer",props:{isDrawerOpen:{type:Boolean},users:{},statuses:{},errors:{},task:{}},emits:["update:isDrawerOpen","taskData"],setup(ee,{expose:U,emit:R}){var m;const n=ee,v=R,$=u(!1),q=u(),F=u(n.task.title),x=u(n.task.description),D=u(be(n.task.deadline)),C=u((m=n.task.assigned_to)==null?void 0:m.id),_=u(n.task.status),w=()=>{v("update:isDrawerOpen",!1),pe(()=>{var l,r;(l=q.value)==null||l.reset(),(r=q.value)==null||r.resetValidation()})};ne(()=>n.task,l=>{var r;F.value=l.title,x.value=l.description,D.value=be(l.deadline),C.value=(r=l.assigned_to)==null?void 0:r.id,_.value=l.status},{immediate:!0,deep:!0});const h=()=>{var l;(l=q.value)==null||l.validate().then(({valid:r})=>{r&&v("taskData",{id:n.task.id,title:F.value,description:x.value,deadline:D.value,assigned_to:C.value,status:_.value})})};U({closeNavigationDrawer:w});const T=l=>{v("update:isDrawerOpen",l)};return(l,r)=>{const O=Ae,g=xe;return k(),S(Ne,{temporary:"",width:600,location:"end",class:"scrollable-content","model-value":n.isDrawerOpen,"onUpdate:modelValue":T},{default:a(()=>[e(O,{title:"Edit Task",onCancel:w}),e(I),e(t(qe),{options:{wheelPropagation:!1}},{default:a(()=>[e(te,{flat:""},{default:a(()=>[e(Y,null,{default:a(()=>[e(Ee,{ref_key:"refForm",ref:q,modelValue:t($),"onUpdate:modelValue":r[5]||(r[5]=d=>f($)?$.value=d:null),onSubmit:Oe(h,["prevent"])},{default:a(()=>[e(ce,null,{default:a(()=>[e(V,{cols:"12"},{default:a(()=>[e(Pe,{modelValue:t(F),"onUpdate:modelValue":r[0]||(r[0]=d=>f(F)?F.value=d:null),rules:["requiredValidator"in l?l.requiredValidator:t(L)],label:"Title","error-messages":n.errors.title,placeholder:"Title"},null,8,["modelValue","rules","error-messages"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(Be,{modelValue:t(x),"onUpdate:modelValue":r[1]||(r[1]=d=>f(x)?x.value=d:null),label:"Description",placeholder:"Description",rules:["requiredValidator"in l?l.requiredValidator:t(L)],"error-messages":n.errors.description,"auto-grow":""},null,8,["modelValue","rules","error-messages"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(g,{modelValue:t(D),"onUpdate:modelValue":r[2]||(r[2]=d=>f(D)?D.value=d:null),label:"Deadline",placeholder:"Deadline",clearable:"",config:{dateFormat:"d-m-Y",minDate:new Date(t(D))},"clear-icon":"ri-close-fill","error-messages":n.errors.deadline,rules:["requiredValidator"in l?l.requiredValidator:t(L)]},null,8,["modelValue","config","error-messages","rules"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(ze,{modelValue:t(C),"onUpdate:modelValue":r[3]||(r[3]=d=>f(C)?C.value=d:null),label:"Assigned To",placeholder:"Assigned To",items:n.users,"auto-select-first":"",clearable:"",chips:"","error-messages":n.errors.assigned_to,rules:["requiredValidator"in l?l.requiredValidator:t(L)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(me,{modelValue:t(_),"onUpdate:modelValue":r[4]||(r[4]=d=>f(_)?_.value=d:null),label:"Select status",placeholder:"Select status","error-messages":n.errors.status,rules:["requiredValidator"in l?l.requiredValidator:t(L)],items:n.statuses},null,8,["modelValue","error-messages","rules","items"])]),_:1}),e(V,{cols:"12"},{default:a(()=>[e(E,{type:"submit",class:"me-4"},{default:a(()=>[p(" Submit ")]),_:1}),e(E,{type:"reset",variant:"outlined",color:"error",onClick:w},{default:a(()=>[p(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),Va={class:"d-flex align-center"},ya=y("h3",{class:"text-h6"},"Assigned to",-1),ba={class:"d-flex align-center"},_a={class:"text-body-1 font-weight-medium"},wa={class:"d-flex align-center"},Da=y("h3",{class:"text-h6"},"Status",-1),ha=y("span",null,"Click to update status",-1),Ca={class:"d-flex align-center"},Ta=y("h3",{class:"text-h6"},"Deadline",-1),Sa=y("h3",{class:"text-h6"},"Files",-1),Ua={class:"d-flex flex-wrap"},$a=y("h3",{class:"text-h6 mb-3"},"Description",-1),Fa=y("h3",{class:"text-h6 mb-3"},"Comments",-1),xa={class:"d-flex justify-space-between align-center mb-3"},Oa={class:"d-flex gap-3 align-center"},Aa={class:"text-body-1 font-weight-medium"},qa={class:"text-caption"},Ea={class:"text-body-1"},Pa={key:0},Ba=De({__name:"ViewTaskDrawer",props:{isDrawerOpen:{type:Boolean},task:{},statuses:{},errors:{},resolveTaskStatusColor:{type:Function}},emits:["update:isDrawerOpen","commentData","statusUpdate","deleteComment"],setup(ee,{expose:U,emit:R}){const n=Ye("userData").value,v=ee,$=R,q=m=>{$("update:isDrawerOpen",m),!m&&pe(()=>{var l,r;(l=C.value)==null||l.reset(),(r=C.value)==null||r.resetValidation()})},F=()=>{$("update:isDrawerOpen",!1),pe(()=>{var m,l;(m=C.value)==null||m.reset(),(l=C.value)==null||l.resetValidation()})},x=async(m,l)=>{var d;const r=await Q(`/tasks/files/${m.id}`,{responseType:"blob"}),O=URL.createObjectURL(new Blob([r])),g=document.createElement("a");g.href=O,g.setAttribute("download",`File ${l+1}.${Fe(m.file)}`),document.body.appendChild(g),g.click(),(d=g.parentNode)==null||d.removeChild(g)},D=u([]),C=u(),_=u(!1),w=u(!1);let h;const T=m=>{var l;(l=C.value)==null||l.validate().then(async({valid:r})=>{if(r){const O=new FormData(m.target);$("commentData",O)}})};return U({commentForm:C}),(m,l)=>{const r=Ae,O=He;return k(),j(X,null,[e(Ne,{temporary:"",width:600,location:"end",class:"scrollable-content","model-value":v.isDrawerOpen,"onUpdate:modelValue":q},{default:a(()=>[e(r,{title:v.task.title,onCancel:F},null,8,["title"]),e(I),e(t(qe),{options:{wheelPropagation:!1}},{default:a(()=>[e(te,{flat:""},{default:a(()=>[e(Y,null,{default:a(()=>[e(ce,null,{default:a(()=>{var g;return[e(V,{cols:"12"},{default:a(()=>{var d;return[y("div",Va,[ya,e(ye),y("div",ba,[e(je,{size:"small",color:"primary",variant:"tonal",class:"me-2"},{default:a(()=>{var c;return[p(b(("getInitials"in m?m.getInitials:t(Le))((c=v.task.assigned_to)==null?void 0:c.name)),1)]}),_:1}),y("span",_a,b((d=v.task.assigned_to)==null?void 0:d.name),1)])])]}),_:1}),e(I),e(V,{cols:"12"},{default:a(()=>{var d;return[y("div",wa,[Da,e(ye),t(n).id===((d=v.task.assigned_to)==null?void 0:d.id)?(k(),S(Je,{key:0,transition:"slide-y-transition"},{activator:a(({props:c})=>[e(ue,{location:"top"},{activator:a(({props:z})=>[e(K,we(we(c,z),{elevation:"5",color:m.resolveTaskStatusColor(v.task.status),size:"small",class:"text-uppercase"}),{default:a(()=>{var Z;return[p(b((Z=m.statuses.find(G=>G.value===v.task.status))==null?void 0:Z.title),1)]}),_:2},1040,["color"])]),default:a(()=>[ha]),_:2},1024)]),default:a(()=>[e(Ke,null,{default:a(()=>[(k(!0),j(X,null,de(m.statuses,c=>(k(),S(Ze,{key:c.value,value:c.value,onClick:z=>$("statusUpdate",{id:v.task.id,status:c.value})},{default:a(()=>[p(b(c.title),1)]),_:2},1032,["value","onClick"]))),128))]),_:1})]),_:1})):(k(),S(K,{key:1,color:m.resolveTaskStatusColor(v.task.status),size:"small",class:"text-uppercase",elevation:"5"},{default:a(()=>{var c;return[p(b((c=m.statuses.find(z=>z.value===v.task.status))==null?void 0:c.title),1)]}),_:1},8,["color"]))])]}),_:1}),e(I),e(V,{cols:"12"},{default:a(()=>[y("div",Ca,[Ta,e(ye),e(K,{color:("checkDeadlineStatus"in m?m.checkDeadlineStatus:t(_e))(v.task.deadline)==="exceeded"?"error":("checkDeadlineStatus"in m?m.checkDeadlineStatus:t(_e))(v.task.deadline)==="approaching"?"success":"warning",elevation:"5",size:"small",class:"font-weight-medium"},{default:a(()=>[p(b(("parseDate"in m?m.parseDate:t(be))(v.task.deadline)),1)]),_:1},8,["color"])])]),_:1}),e(I),((g=v.task.files)==null?void 0:g.length)>0?(k(),j(X,{key:0},[e(V,{cols:"12"},{default:a(()=>[Sa,y("div",Ua,[(k(!0),j(X,null,de(v.task.files,(d,c)=>(k(),S(K,{class:"me-2 mb-2",key:d.id,style:{width:"fit-content"},elevation:"5",variant:"elevated","prepend-icon":"$file",color:"primary",onClick:z=>x(d,c)},{default:a(()=>[p(b(`File ${c+1}.${("extractFileExtension"in m?m.extractFileExtension:t(Fe))(d.file)}`),1)]),_:2},1032,["onClick"]))),128))])]),_:1}),e(I)],64)):N("",!0),e(V,{cols:"12"},{default:a(()=>[$a,y("p",null,b(v.task.description),1)]),_:1}),e(I),e(V,{cols:"12"},{default:a(()=>{var d;return[Fa,((d=v.task.comments)==null?void 0:d.length)>0?(k(!0),j(X,{key:0},de(v.task.comments,(c,z)=>{var Z;return k(),j("div",{key:c.id,class:"mb-5"},[y("div",xa,[y("div",null,[y("div",Oa,[e(je,{color:"primary",variant:"tonal"},{default:a(()=>[p(b(("getInitials"in m?m.getInitials:t(Le))(c.created_by.name)),1)]),_:2},1024),y("div",null,[y("div",Aa,b(c.created_by.name),1),y("div",qa,b(c.created_at),1)])])]),y("div",null,[t(n).role.value==="admin"||c.created_by.id===t(n).id?(k(),S(E,{key:0,size:"small",variant:"tonal",color:"error",icon:"ri-delete-bin-6-line",onClick:G=>{w.value=!0,f(h)?h.value=z:h=z}},null,8,["onClick"])):N("",!0)])]),y("p",Ea,b(c.comment),1),((Z=c.files)==null?void 0:Z.length)>0?(k(),j("div",Pa,[(k(!0),j(X,null,de(c.files,(G,fe)=>(k(),S(K,{class:"me-2 mb-2",key:G.id,style:{width:"fit-content"},elevation:"5",variant:"elevated","prepend-icon":"$file",color:"primary",onClick:ve=>x(G,fe)},{default:a(()=>[p(b(`File ${fe+1}.${("extractFileExtension"in m?m.extractFileExtension:t(Fe))(G.file)}`),1)]),_:2},1032,["onClick"]))),128))])):N("",!0),z!==v.task.comments.length-1?(k(),S(I,{key:1,class:"my-3"})):N("",!0)])}),128)):N("",!0),e(Ee,{ref_key:"refForm",ref:C,modelValue:t(_),"onUpdate:modelValue":l[1]||(l[1]=c=>f(_)?_.value=c:null),onSubmit:Oe(T,["prevent"])},{default:a(()=>[e(ce,null,{default:a(()=>[e(V,{cols:"12"},{default:a(()=>[e(Be,{label:"Comment",placeholder:"Comment",name:"comment",rules:["requiredValidator"in m?m.requiredValidator:t(L)],"auto-grow":"",rows:"2"},null,8,["rules"])]),_:1}),e(V,{cols:"12"},{default:a(()=>{var c;return[e(Ge,{modelValue:t(D),"onUpdate:modelValue":l[0]||(l[0]=z=>f(D)?D.value=z:null),label:"Select files",placeholder:"Select files",clearable:"",multiple:"","prepend-icon":"","append-icon":"$file",chips:"","show-size":"",rules:["fileValidator"in m?m.fileValidator:t(Qe)],counter:"",color:"primary","counter-size-string":String((c=t(D))==null?void 0:c.length),name:"files[]",accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt"},null,8,["modelValue","rules","counter-size-string"])]}),_:1}),e(V,{cols:"12"},{default:a(()=>[e(E,{type:"submit",class:"me-4"},{default:a(()=>[p(" Submit ")]),_:1}),e(E,{type:"reset",variant:"outlined",color:"error",onClick:F},{default:a(()=>[p(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1})]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(We,{modelValue:t(w),"onUpdate:modelValue":l[5]||(l[5]=g=>f(w)?w.value=g:null),width:"400"},{default:a(()=>[e(te,{title:"Confirmation",class:"pb-5"},{default:a(()=>[e(O,{variant:"text",size:"default",onClick:l[2]||(l[2]=g=>w.value=!1)}),e(Y,null,{default:a(()=>[p(" Are you sure you want to delete this comment ? ")]),_:1}),e(Y,{class:"d-flex align-center justify-center gap-4"},{default:a(()=>[e(E,{variant:"elevated",onClick:l[3]||(l[3]=g=>{w.value=!1,$("deleteComment",t(h))}),color:"error"},{default:a(()=>[p(" Confirm ")]),_:1}),e(E,{color:"secondary",variant:"outlined",onClick:l[4]||(l[4]=g=>w.value=!1)},{default:a(()=>[p(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),za=y("span",null,"Click to update status",-1),Na={class:"d-flex justify-end flex-wrap gap-x-6 px-2 py-1"},Ra={class:"d-flex align-center gap-x-2 text-medium-emphasis text-base"},Ma={class:"d-flex align-center text-base text-high-emphasis me-2 mb-0"},Ia={class:"d-flex gap-x-2 align-center me-2"},jt=De({__name:"list",async setup(ee){let U,R;const n=Ye("userData").value,v=u(""),$=u(),q=u(),F=u(),x=u(),D=u(!1),C=u("no");ne(D,i=>{C.value=i?"yes":"no"});const _=u({});let w;const h=u(20),T=u(1),m=u("id"),l=u("desc"),r=u([]),O=u(!1),g=u(),d=u(),c=u(),z=i=>{var s,A;m.value=(s=i.sortBy[0])==null?void 0:s.key,l.value=(A=i.sortBy[0])==null?void 0:A.order},Z=[{title:"ID",key:"id"},{title:"Title",key:"title"},{title:"Status",key:"status"},{title:"Department",key:"department",sortable:!1,showToOnly:["admin"]},{title:"Assigned To",key:"assigned_to",sortable:!1,showToOnly:["admin","team_lead"]},{title:"Deadline",key:"deadline"},{title:"Created By",key:"created_by",sortable:!1,showToOnly:["admin"]},{title:"Creation Date",key:"created_at"},{title:"Last Updated",key:"updated_at"},{title:"Actions",key:"actions",sortable:!1}],G=Se(()=>Z.filter(i=>i.showToOnly?i.showToOnly.includes(n.role.value):i)),fe=Se(()=>{const i={q:v,user:$,department:q,date:F,status:x,itemsPerPage:h,page:T,sortBy:m,orderBy:l};return n.role.value==="team_lead"&&(i.assignedToMe=C),i}),{data:ve,execute:he,isFetching:Xe}=([U,R]=Ue(()=>ma(pa("tasks",{query:fe}))),U=await U,R(),U);ne(()=>Xe.value,i=>{O.value=i},{immediate:!0});const Ce=u(ve.value.tasks),le=Se(()=>ve.value.totalTasks);ne(ve,i=>{Ce.value=i.tasks});const J=[{title:"Pending",value:"pending"},{title:"In Progress",value:"in_progress"},{title:"Completed",value:"completed"}],ge=u([]),Re=u([]);if(["admin","team_lead"].includes(n.role.value)){const{users:i}=([U,R]=Ue(()=>{var s;return Q("users",{query:{department:(s=n==null?void 0:n.department)==null?void 0:s.id}})}),U=await U,R(),U);if(ge.value=i.map(s=>({value:s.id,title:s.name})),n.role.value==="admin"){const{departments:s}=([U,R]=Ue(()=>Q("departments")),U=await U,R(),U);Re.value=s.map(A=>({title:A.title,value:A.id}))}}const Te=i=>{switch(i){case"completed":return"success";case"in_progress":return"info";default:return"error"}},ke=u(!1),se=u(!1),oe=u(!1),M=u(!1),W=u(!1);let H;const ea=async i=>{const{success:s,message:A}=await Q("tasks",{method:"POST",body:i,onResponseError({response:P}){re.value=P._data.errors}});s&&(M.value=!0,H=A,g.value.closeNavigationDrawer(),he())},aa=async i=>{const{success:s,message:A}=await Q(`tasks/${i.id}`,{method:"PUT",body:i,onResponseError({response:P}){re.value=P._data.errors}});s&&(M.value=!0,H=A,d.value.closeNavigationDrawer(),he())},ta=i=>{_.value=i,oe.value=!0},la=async()=>{const{success:i,message:s}=await Q(`tasks/${w}`,{method:"DELETE"});W.value=!1,i&&(M.value=!0,H=s,he())},sa=async i=>{const{success:s,message:A,comment:P}=await Q(`tasks/${_.value.id}/comments`,{method:"POST",body:i});s&&(M.value=!0,H=A,_.value.comments.push(P),c.value.commentForm.reset())},oa=i=>{_.value=i,se.value=!0},re=u({title:void 0,description:void 0,deadline:void 0,assigned_to:void 0,files:[],status:void 0,comment:void 0}),Me=async({id:i,status:s})=>{const A=Ce.value.find(P=>P.id===i);if(A.status!==s){const{success:P,message:ie}=await Q(`tasks/${i}/status`,{method:"PATCH",body:{status:s},onResponseError({response:o}){console.error(o._data.message),M.value=!0,H="Something went wrong! Please try again."}});P&&(A.status=s,M.value=!0,H=ie)}},ae=i=>O.value||!(n.role.value==="admin"||i===n.id),ra=async i=>{const s=_.value.comments[i],{success:A,message:P}=await Q(`tasks/comments/${s.id}`,{method:"DELETE",onResponseError({response:ie}){console.error(ie._data.message),M.value=!0,H="Something went wrong! Please try again."}});A&&(_.value.comments.splice(i,1),M.value=!0,H=P)};return ne([se,oe],([i,s])=>{!i&&!s&&(_.value={})}),(i,s)=>{const A=xe,P=da("IconBtn"),ie=He;return k(),j("section",null,[e(te,{class:"mb-6"},{default:a(()=>[e(ua,{class:"text-h4 py-5"},{default:a(()=>[p(b(["admin","team_lead"].includes(t(n).role.value)?"Filters":"Tasks"),1)]),_:1}),["admin","team_lead"].includes(t(n).role.value)?(k(),S(Y,{key:0},{default:a(()=>[e(ce,{align:"center"},{default:a(()=>[t(n).role.value==="team_lead"?(k(),S(V,{key:0,cols:"2"},{default:a(()=>[e(ca,{modelValue:t(D),"onUpdate:modelValue":s[0]||(s[0]=o=>f(D)?D.value=o:null),inset:!1,label:t(D)?"Assigned to me":"Assigned by me"},null,8,["modelValue","label"])]),_:1})):N("",!0),t(n).role.value==="admin"?(k(),S(V,{key:1},{default:a(()=>[e(me,{modelValue:t(q),"onUpdate:modelValue":s[1]||(s[1]=o=>f(q)?q.value=o:null),label:"Filter by Department",placeholder:"Filter by Department",items:t(Re),clearable:"",chips:""},null,8,["modelValue","items"])]),_:1})):N("",!0),["admin","team_lead"].includes(t(n).role.value)?(k(),S(V,{key:2},{default:a(()=>[e(ze,{modelValue:t($),"onUpdate:modelValue":s[2]||(s[2]=o=>f($)?$.value=o:null),label:"Filter by User",placeholder:"Filter by User",items:t(ge),"auto-select-first":"",clearable:"",chips:""},null,8,["modelValue","items"])]),_:1})):N("",!0),e(V,null,{default:a(()=>[e(A,{modelValue:t(F),"onUpdate:modelValue":s[3]||(s[3]=o=>f(F)?F.value=o:null),label:"Filter by Date",placeholder:"Filter by Date",clearable:"",config:{dateFormat:"d-m-Y"},"clear-icon":"ri-close-line"},null,8,["modelValue"])]),_:1}),["admin","team_lead"].includes(t(n).role.value)?(k(),S(V,{key:3},{default:a(()=>[e(me,{modelValue:t(x),"onUpdate:modelValue":s[4]||(s[4]=o=>f(x)?x.value=o:null),label:"Filter by Status",placeholder:"Filter by Status",items:J,clearable:"",chips:""},null,8,["modelValue"])]),_:1})):N("",!0),e(V,null,{default:a(()=>[e(Pe,{modelValue:t(v),"onUpdate:modelValue":s[5]||(s[5]=o=>f(v)?v.value=o:null),placeholder:"Filter by Query",density:"comfortable",clearable:"",label:"Filter by Query",class:"me-4"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):N("",!0),e(I),["admin","team_lead"].includes(t(n).role.value)?(k(),S(Y,{key:1,class:"d-flex flex-wrap gap-4"},{default:a(()=>[e(E,{color:"success","prepend-icon":"ri-upload-2-line"},{default:a(()=>[p(" Import ")]),_:1}),e(E,{color:"secondary","prepend-icon":"ri-download-2-line"},{default:a(()=>[p(" Export ")]),_:1}),e(ye),e(E,{onClick:s[6]||(s[6]=o=>ke.value=!0),"prepend-icon":"ri-task-fill"},{default:a(()=>[p(" Add New Task ")]),_:1})]),_:1})):N("",!0),e(fa,{"items-per-page":t(h),"onUpdate:itemsPerPage":s[10]||(s[10]=o=>f(h)?h.value=o:null),"model-value":t(r),"onUpdate:modelValue":s[11]||(s[11]=o=>f(r)?r.value=o:null),hover:"","show-select":"","sort-by":[{key:t(m),order:t(l)}],loading:t(O),"loading-text":"Loading Tasks...","disable-sort":t(O),"fixed-header":"",style:{"max-height":"500px"},page:t(T),"onUpdate:page":s[12]||(s[12]=o=>f(T)?T.value=o:null),items:t(Ce),"item-value":"id","items-length":t(le),headers:t(G),class:"text-no-wrap rounded-0","onUpdate:options":z,density:"default"},{"item.status":a(({item:o})=>[t(n).id===o.assigned_to.id?(k(),S(Je,{key:0,transition:"slide-y-transition"},{activator:a(({props:B})=>[e(ue,{location:"top"},{activator:a(({props:Ve})=>[e(K,we(we(B,Ve),{elevation:"5",color:Te(o.status),size:"small",class:"text-uppercase"}),{default:a(()=>{var Ie;return[p(b((Ie=J.find(ia=>ia.value===o.status))==null?void 0:Ie.title),1)]}),_:2},1040,["color"])]),default:a(()=>[za]),_:2},1024)]),default:a(()=>[e(Ke,null,{default:a(()=>[(k(),j(X,null,de(J,B=>e(Ze,{key:B.value,value:B.value,onClick:Ve=>Me({id:o.id,status:B.value})},{default:a(()=>[p(b(B.title),1)]),_:2},1032,["value","onClick"])),64))]),_:2},1024)]),_:2},1024)):(k(),S(K,{key:1,color:Te(o.status),size:"small",class:"text-uppercase",elevation:"5"},{default:a(()=>{var B;return[p(b((B=J.find(Ve=>Ve.value===o.status))==null?void 0:B.title),1)]}),_:2},1032,["color"]))]),"item.department":a(({item:o})=>{var B;return[p(b(((B=o.assigned_to.department)==null?void 0:B.title)??"Not assigned"),1)]}),"item.assigned_to":a(({item:o})=>[p(b(o.assigned_to.name),1)]),"item.deadline":a(({item:o})=>[e(K,{color:("checkDeadlineStatus"in i?i.checkDeadlineStatus:t(_e))(o.deadline)==="exceeded"?"error":("checkDeadlineStatus"in i?i.checkDeadlineStatus:t(_e))(o.deadline)==="approaching"?"success":"warning",size:"small",elevation:"5"},{default:a(()=>[p(b(("parseDate"in i?i.parseDate:t(be))(o.deadline)),1)]),_:2},1032,["color"])]),"item.created_by":a(({item:o})=>[p(b(o.created_by.name),1)]),"item.created_at":a(({item:o})=>[p(b(o.created_at),1)]),"item.updated_at":a(({item:o})=>[p(b(o.updated_at),1)]),"item.actions":a(({item:o})=>[e(P,{size:"small",disabled:t(O),color:"info",onClick:B=>ta(o),variant:"flat"},{default:a(()=>[e($e,{icon:"ri-eye-fill"}),e(ue,{activator:"parent",location:"top"},{default:a(()=>[p(" View ")]),_:1})]),_:2},1032,["disabled","onClick"]),e(P,{size:"small",onClick:B=>oa(o),color:"primary",variant:ae(o.created_by.id)?"text":"flat",class:"mx-2",disabled:ae(o.created_by.id)},{default:a(()=>[e($e,{icon:ae(o.created_by.id)?"ri-edit-box-line":"ri-edit-box-fill"},null,8,["icon"]),e(ue,{activator:"parent",location:"top"},{default:a(()=>[p(" Edit ")]),_:1})]),_:2},1032,["onClick","variant","disabled"]),e(P,{onClick:B=>{W.value=!0,f(w)?w.value=o.id:w=o.id},color:"error",size:"small",variant:ae(o.created_by.id)?"text":"flat",disabled:ae(o.created_by.id)},{default:a(()=>[e($e,{icon:ae(o.created_by.id)?"ri-delete-bin-line":"ri-delete-bin-fill"},null,8,["icon"]),e(ue,{activator:"parent",location:"top"},{default:a(()=>[p(" Delete ")]),_:1})]),_:2},1032,["onClick","variant","disabled"])]),bottom:a(()=>[e(I),y("div",Na,[y("div",Ra,[p(" Rows Per Page: "),e(me,{modelValue:t(h),"onUpdate:modelValue":s[7]||(s[7]=o=>f(h)?h.value=o:null),class:"per-page-select",variant:"plain",items:[10,20,25,50,100]},null,8,["modelValue"])]),y("p",Ma,b(("paginationMeta"in i?i.paginationMeta:t(na))({page:t(T),itemsPerPage:t(h)},t(le))),1),y("div",Ia,[e(E,{class:"flip-in-rtl",icon:"ri-arrow-left-s-line",variant:"text",density:"comfortable",color:"high-emphasis",disabled:t(T)<=1,onClick:s[8]||(s[8]=o=>t(T)<=1?T.value=1:T.value--)},null,8,["disabled"]),e(E,{class:"flip-in-rtl",icon:"ri-arrow-right-s-line",density:"comfortable",variant:"text",color:"high-emphasis",disabled:t(T)>=Math.ceil(t(le)/t(h)),onClick:s[9]||(s[9]=o=>t(T)>=Math.ceil(t(le)/t(h))?T.value=Math.ceil(t(le)/t(h)):T.value++)},null,8,["disabled"])])])]),_:1},8,["items-per-page","model-value","sort-by","loading","disable-sort","page","items","items-length","headers"])]),_:1}),["admin","team_lead"].includes(t(n).role.value)?(k(),S(ga,{key:0,isDrawerOpen:t(ke),"onUpdate:isDrawerOpen":s[13]||(s[13]=o=>f(ke)?ke.value=o:null),onTaskData:ea,users:t(ge),statuses:J,ref_key:"addNewTaskDrawerRef",ref:g,errors:t(re)},null,8,["isDrawerOpen","users","errors"])):N("",!0),["admin","team_lead"].includes(t(n).role.value)?(k(),S(ka,{key:1,isDrawerOpen:t(se),"onUpdate:isDrawerOpen":s[14]||(s[14]=o=>f(se)?se.value=o:null),onTaskData:aa,users:t(ge),statuses:J,task:t(_),ref_key:"editTaskDrawerRef",ref:d,errors:t(re)},null,8,["isDrawerOpen","users","task","errors"])):N("",!0),e(Ba,{isDrawerOpen:t(oe),"onUpdate:isDrawerOpen":s[15]||(s[15]=o=>f(oe)?oe.value=o:null),task:t(_),statuses:J,resolveTaskStatusColor:Te,errors:t(re),ref_key:"viewTaskDrawerRef",ref:c,onCommentData:sa,onStatusUpdate:Me,onDeleteComment:ra},null,8,["isDrawerOpen","task","errors"]),e(va,{modelValue:t(M),"onUpdate:modelValue":s[17]||(s[17]=o=>f(M)?M.value=o:null)},{actions:a(()=>[e(E,{color:"error",onClick:s[16]||(s[16]=o=>M.value=!1)},{default:a(()=>[p(" Close ")]),_:1})]),default:a(()=>[p(b(t(H))+" ",1)]),_:1},8,["modelValue"]),e(We,{modelValue:t(W),"onUpdate:modelValue":s[21]||(s[21]=o=>f(W)?W.value=o:null),width:"400"},{default:a(()=>[e(te,{title:"Confirmation",class:"pb-5"},{default:a(()=>[e(ie,{variant:"text",size:"default",onClick:s[18]||(s[18]=o=>W.value=!1)}),e(Y,null,{default:a(()=>[p(" Are you sure you want to delete this task? ")]),_:1}),e(Y,{class:"d-flex align-center justify-center gap-4"},{default:a(()=>[e(E,{variant:"elevated",onClick:s[19]||(s[19]=o=>la()),color:"error"},{default:a(()=>[p(" Confirm ")]),_:1}),e(E,{color:"secondary",variant:"outlined",onClick:s[20]||(s[20]=o=>W.value=!1)},{default:a(()=>[p(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{jt as default};
